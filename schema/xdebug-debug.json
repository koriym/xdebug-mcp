{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://koriym.github.io/xdebug-mcp/schemas/xdebug-debug.json",
  "title": "Xdebug MCP Debug Output Schema",
  "description": "JSON schema for xdebug-debug output with multiple breakpoints",
  "type": "object",
  "properties": {
    "breaks": {
      "type": "array",
      "description": "Array of breakpoint hits with captured state",
      "items": {
        "type": "object",
        "properties": {
          "step": {
            "type": "integer",
            "description": "Sequential step number (1, 2, 3, ...)",
            "minimum": 1
          },
          "location": {
            "type": "object",
            "description": "Code location where breakpoint was hit",
            "properties": {
              "file": {
                "type": "string",
                "description": "Filename (basename) where breakpoint occurred",
                "examples": ["test_multiple_breaks.php", "UserController.php"]
              },
              "line": {
                "type": "integer",
                "description": "Line number where breakpoint occurred",
                "minimum": 1
              }
            },
            "required": ["file", "line"],
            "additionalProperties": false
          },
          "variables": {
            "type": "object",
            "description": "Local variables at breakpoint with type information",
            "patternProperties": {
              "^\\$[a-zA-Z_][a-zA-Z0-9_]*$": {
                "type": "string",
                "description": "Variable value with type prefix (e.g., 'int: 42', 'array: ', 'uninitialized: ')",
                "examples": ["int: 42", "string: hello", "array: ", "uninitialized: ", "null: "]
              }
            },
            "additionalProperties": false
          }
        },
        "required": ["step", "location", "variables"],
        "additionalProperties": false
      }
    },
    "trace": {
      "type": "object",
      "description": "Xdebug trace file information",
      "properties": {
        "file": {
          "type": "string",
          "description": "Path to the trace file",
          "examples": ["/tmp/trace.123456.xt", ""]
        },
        "content": {
          "type": "array",
          "description": "Lines from the trace file for AI analysis",
          "items": {
            "type": "string",
            "description": "Individual trace line"
          }
        }
      },
      "required": ["file", "content"],
      "additionalProperties": false
    },
    "context": {
      "type": "string",
      "description": "Optional contextual description provided by user for AI analysis (e.g., 'Login validation test', 'Payment processing edge case')",
      "examples": [
        "Testing user authentication with valid credentials",
        "Debugging payment processing edge case with invalid card",
        "Unit test for UserService::authenticate() method"
      ]
    }
  },
  "required": ["breaks", "trace"],
  "additionalProperties": false,
  "examples": [
    {
      "breaks": [
        {
          "step": 1,
          "location": {
            "file": "test_multiple_breaks.php",
            "line": 12
          },
          "variables": {
            "$data": "uninitialized: ",
            "$final": "uninitialized: ",
            "$multiplier": "uninitialized: ",
            "$result": "uninitialized: "
          }
        },
        {
          "step": 2,
          "location": {
            "file": "test_multiple_breaks.php",
            "line": 4
          },
          "variables": {
            "$num": "uninitialized: ",
            "$numbers": "array: ",
            "$sum": "uninitialized: "
          }
        }
      ],
      "trace": {
        "file": "/tmp/trace.123456.xt",
        "content": [
          "Version: 3.4.4",
          "File format: 4",
          "TRACE START [2025-08-27 00:35:21.881182]",
          "1\t0\t0\t0.000763\t401280\t{main}\t1\t\t/Users/akihito/git/xdebug-mcp/test_multiple_breaks.php\t0\t0"
        ]
      }
    }
  ]
}
