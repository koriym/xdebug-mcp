#!/usr/bin/env php
<?php

declare(strict_types=1);

// Load autoloader and determine project root
$autoloadPath = require __DIR__ . '/autoload.php';

// Determine project root from autoloader path
$projectRoot = str_contains($autoloadPath, '/vendor/autoload.php') 
    ? dirname($autoloadPath, 2)
    : dirname($autoloadPath);

if (!file_exists($projectRoot . '/composer.json')) {
    fwrite(STDERR, "Error: Could not determine project root from autoloader path.\n");
    exit(1);
}

// Note: Using absolute paths instead of chdir() for stability

// Run the command
use Koriym\XdebugMcp\XdebugPhpunitCommand;

$xdebugOutputDir = ini_get('xdebug.output_dir') ?: '/tmp';
$command = new XdebugPhpunitCommand($projectRoot, $xdebugOutputDir);
$exitCode = $command($argv);

exit($exitCode);